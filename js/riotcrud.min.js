"use strict";var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?obj=>typeof obj:obj=>obj&&typeof Symbol=="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;;(function(a,b,f,g){"use strict";var m=this,n=null,p=null,q={},r={},s={default:{html:!1,routes:{}}},t="#content",u={target:"#main",options:{},query:{}};function h(){return this}h.prototype={defaults:w=>{u=Object.assign({},u,w);return m},addRoute:(w,x)=>{x=Object.assign({},u,x);r[w]=x;return m},addMenuGroup:(w,x)=>{s[w]=Object.assign({},x,{routes:{}})},getRoutes:()=>r,getRouteMenu:()=>{for(var k in r){if(r[k].menu){s[r[k].menuGroup||"default"].routes[k]=r[k]}}return s},addDependencies:(w,d)=>{q[w]=d;return m},loadDependencies:(w,x,y)=>{var z=[];if(typeof w!="undefined")z=w;if(g&&z.length>0){g(z,()=>{if(typeof y=="function"){y()}})}else{if(typeof y=="function"){y()}}},start:w=>{f.parser(l);f.start(!0);if(f)f(w);return m}};function j(w,x,y){if(n!=null&&x==n.root.getAttribute("riot-tag")&&y.model==n.opts.model){n.refresh(y)}else{n&&n.unmount(!0);n=b.mount(w,x,y)[0];p=x}}function l(collection,action,param){var z=w.split("?"),A=z[0].split("/"),B=z[1],C={};if(B){B.split("&").forEach(v=>{var c=v.split("=");C[c[0]]=c[1]})}var w=A[0],x=A[1],y=A[2];if(typeof r[w]=="undefined"&&typeof r[w+x]=="undefined"){console.error("RiotCrudController no route found",{collection:w,action:x,param:y,routes:r,uri:A,qs:B,params:C});return}var D=r[w]||r[w+x];D.query={id:y,query:f.query()};RiotCrudController.loadDependencies(D.dependencies,D.route,()=>{RiotControl.trigger("routeStateChange",D.route);if(typeof D.fn=="function"){p=null;n=null;D.fn(w,y,x)}else{j(D.target||t,D.tag||w+"-"+x,D)}})}if(!a.RiotCrudController){a.RiotCrudController=new h}})(window,riot,route,$script);;(function(a,b,$){"use strict";function f(){this.opts={idfield:"_id",showheader:!0,showpagination:!0,changelimit:!0}}f.prototype={defaults:function g(o){this.opts=$.extend(this.opts,o||{});return this},addModel:function g(h,j,l){var m=$.extend({model:h},this.opts,j||{});for(var n in l){var p=$.extend({name:h,route:h+"/"+n},m,l[n]);p.view=n;p.views=Object.keys(l);RiotCrudController.addRoute(h+n,p)}return this}};a.RiotCrudModel=new f})(window,riot,$);;(function(a,b,f,g){a.RiotControl={_stores:[],addStore:function j(l){this._stores.push(l)},reset:function j(){this._stores=[]}};["on","one","off","trigger"].forEach(function(j){RiotControl[j]=function(){var l=[].slice.call(arguments);this._stores.forEach(m=>{m[j].apply(m,l)})}});if(typeof module!="undefined")module.exports=RiotControl;function h(){if(!(this instanceof h))return new h;b.observable(this);var j=this}RiotControl.addStore(new h);b.mixin("FeatherClientMixin",{init:function j(){var l=this,m={idfield:"_id",dependencies:[]};Object.assign(this.opts,m);this.socket=io(this.opts.endpoint||"http://"+a.location.hostname+":3030");this.client=feathers().configure(feathers.hooks()).configure(feathers.socketio(this.socket));if(typeof this.opts.service!="undefined"&&this.opts.view){this.service=this.client.service(this.opts.service);var n=[this.opts.service,this.opts.view].join("_");this.eventMap={actionDeleteConfirmation:n+"_delete_confirmation",actionDeleteConfirmed:n+"_delete",actionEditSave:this.opts.service+"_save",actionCreateSave:this.opts.service+"_create",actionQuery:this.opts.service+"_query"};this.on("*",p=>{switch(p){case"mount":break;case"before-mount":case"unmount":if(p=="before-mount"){l.loadDependencies()}for(var q=Object.keys(l.eventMap),i=0;i<q.length;i++){if(p=="unmount"){RiotControl.off(l.eventMap[q[i]])}else{l.bindEvent(l.eventMap[q[i]],q[i])}}break;default:if(l.debug)console.info("FeatherClientMixin event:"+p,l.opts.title);break;}})}else{if(this.debug)console.warn("FeatherClientMixin no service",this.root.tagName)}},loadDependencies:function j(){var l=this;if(!l.dependencies||l.dependencies&&l.dependencies.length==0){l.loadSchema()}else{var m=l.root.tagName+l.opts.service+l.opts.view+l.opts.title;if(l.debug)console.log("loadDependencies",l.root.tagName,l.opts.title,m,l.dependencies);g(l.dependencies,m);g.ready(m,()=>{l.loadSchema()})}},loadSchema:function j(){var l=this;console.log("loadSchema",l.opts.title,l.opts.schema);if(l.opts.schema===!0){l.service.get("schema").then(m=>{l.opts.schema=m;l.loadData(l.opts.query)}).catch(m=>{console.error("loadSchema",m)})}else{l.loadData(l.opts.query)}},loadData:function j(l){var m=this;console.log("loadData",m.opts.title,m.opts.schema);switch(m.opts.view){case"view":case"edit":if(l.id)m.service.get(l.id).then(n=>{m.data=n;if(typeof m.updateView=="undefined"){m.update()}else{m.updateView()}}).catch(n=>{console.error("loadData",n)});break;case"list":m.service.find(l).then(n=>{m.data=n;if(typeof m.updateView=="undefined"){m.update()}else{m.updateView()}}).catch(n=>{console.error("loadData",n)});break;default:break;}},bindEvent:function j(l,m){var n=this;RiotControl.on(l,function(e){if(this.debug){console.info(map[i],this.eventMap[map[i]],e,n.opts,n.eventMap,Object.keys(n))}n[m](e)})},actionQuery:function j(l){if(this.opts.view=="list")return;this.loadData({id:l})},actionDeleteConfirmation:function j(l){console.info("actionDeleteConfirmation",l,this.data);RiotControl.trigger("delete_confirmation_modal",this.opts.service,this.opts.view,l||this.data._id||this.selection)},actionDeleteConfirmed:function j(l){var m=this;if((typeof l=="undefined"?"undefined":_typeof(l))==="object"){var n=l.map(_id=>_id.toString()),p={query:{_id:{$in:n}}};l=null}m.service.remove(l,p).then(q=>{if(m.opts.view!="list"){f([m.opts.service,"list"].join("/"))}else{m.refresh()}}).catch(q=>{console.error(q);RiotControl.trigger("notification",q.errorType+" "+m.eventMap.actionDeleteConfirmed,"error",q.message)})},actionEditSave:function j(){var l=this;console.error(l.opts.service);var m=l.getData();if(m==!1)return!1;l.service.update(m[l.opts.idfield],m).then(n=>{}).catch(n=>{RiotControl.trigger("notification",n.errorType+" "+l.eventMap.actionEditSave,"error",n.message)})},actionCreateSave:function j(){var l=this,m=l.getData();if(m==!1)return!1;delete m._id;delete m.id;console.error("actionCreateSave",m);l.service.create(m).then(n=>{}).catch(n=>{console.error(n);RiotControl.trigger("notification",n.errorType+" "+l.eventMap.actionCreateSave,"error",n.message)})}});b.mixin("ViewActionsMixin",{init:function j(){var l=this,m=["View","Edit","Create","Delete","Save","List","Print","PDF","CSV","Json","Upload"].map((action,index)=>({name:action.toLowerCase(),label:action}));this.on("*",n=>{var p=l;if(n=="before-mount"||n=="update"){var q=l.opts.view||"undefined";l.opts.actions=m.map((r,s)=>{r.active=!1;if(["delete","print","pdf","csv","json"].indexOf(r.name)!=-1){r.count=p.opts.selection||0}switch(q){case"view":if(["edit","delete","create","list"].indexOf(r.name)!=-1){r.active=!0;delete r.count}break;case"edit":if(["save","view","delete","list"].indexOf(r.name)!=-1){r.active=!0;delete r.count}break;case"create":if(["save","list"].indexOf(r.name)!=-1){r.active=!0}break;case"list":if(["delete","create","print","pdf","csv","json","upload"].indexOf(r.name)!=-1){r.active=!0}break;default:break;}if(p.opts.buttons&&p.opts.buttons[r.name]){r.active=!0}return r})}})},actionClick:function j(e){e.preventDefault();if(e.item.action.count===0){return}var l=this.opts.service||this.opts.name,m=this.opts.view,n=e.item.action.name;console.info(Object.keys(e.item));switch(n){case"delete":var p=[l,m,n,"confirmation"].join("_");RiotControl.trigger(p);break;case"save":case"update":if(m=="create"){n="create"}var p=[l,n].join("_");RiotControl.trigger(p);break;case"view":case"edit":f([l,n,this.opts.query.id].join("/"));break;case"list":case"create":f([l,n].join("/"));break;case"upload":RiotControl.trigger([l,"upload","modal"].join("_"));break;default:console.error("unknown event: "+[l,m,n].join("_"));break;}}})})(window,riot,route,$script);