"use strict";var _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?obj=>typeof obj:obj=>obj&&typeof Symbol=="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;;(function(a,b,f,g){"use strict";var m=this,n=null,p=null,q={},r={},s={default:{html:!1,routes:{}}},t="#content",u={target:"#main",options:{},query:{}};function h(){return this}h.prototype={defaults:w=>{u=Object.assign({},u,w);return m},addRoute:(w,x)=>{x=Object.assign({},u,x);r[w]=x;return m},addMenuGroup:(w,x)=>{s[w]=Object.assign({},x,{routes:{}})},getRoutes:()=>r,getRouteMenu:()=>{for(var k in r){if(r[k].menu){s[r[k].menuGroup||"default"].routes[k]=r[k]}}return s},addDependencies:(w,d)=>{q[w]=d;return m},loadDependencies:(w,x,y)=>{var z=[];if(typeof w!="undefined")z=w;if(g&&z.length>0){g(z,()=>{if(typeof y=="function"){y()}})}else{if(typeof y=="function"){y()}}},start:w=>{f.parser(l);f.start(!0);if(f)f(w);return m}};function j(w,x,y){if(n!=null&&x==n.root.getAttribute("riot-tag")&&y.model==n.opts.model){n.refresh(y)}else{n&&n.unmount(!0);n=b.mount(w,x,y)[0];p=x}}function l(collection,action,param){var z=w.split("?"),A=z[0].split("/"),B=z[1],C={};if(B){B.split("&").forEach(v=>{var c=v.split("=");C[c[0]]=c[1]})}var w=A[0],x=A[1],y=A[2];if(typeof r[w]=="undefined"&&typeof r[w+x]=="undefined"){console.error("RiotCrudController no route found",{collection:w,action:x,param:y,routes:r,uri:A,qs:B,params:C});return}var D=r[w]||r[w+x];D.query={id:y,query:f.query()};RiotCrudController.loadDependencies(D.dependencies,D.route,()=>{RiotControl.trigger("routeStateChange",D.route);if(typeof D.fn=="function"){p=null;n=null;D.fn(w,y,x)}else{j(D.target||t,D.tag||w+"-"+x,D)}})}if(!a.RiotCrudController){a.RiotCrudController=new h}})(window,riot,route,$script);;(function(a,b,$){"use strict";function f(){this.opts={idfield:"_id",showheader:!0,showpagination:!0,changelimit:!0}}f.prototype={defaults:function g(o){this.opts=$.extend(this.opts,o||{});return this},addModel:function g(h,j,l){var m=$.extend({model:h},this.opts,j||{});for(var n in l){var p=$.extend({name:h,route:h+"/"+n},m,l[n]);p.view=n;p.views=Object.keys(l);RiotCrudController.addRoute(h+n,p)}return this}};a.RiotCrudModel=new f})(window,riot,$);;(function(a,b,f){a.RiotControl={_stores:[],addStore:function h(j){this._stores.push(j)},reset:function h(){this._stores=[]}};["on","one","off","trigger"].forEach(function(h){RiotControl[h]=function(){var j=[].slice.call(arguments);this._stores.forEach(l=>{l[h].apply(l,j)})}});if(typeof module!="undefined")module.exports=RiotControl;function g(){if(!(this instanceof g))return new g;b.observable(this);var h=this}RiotControl.addStore(new g);b.mixin("FeatherClientMixin",{init:function h(){var j=this,l={idfield:"_id",dependencies:[]};Object.assign(this.opts,l);this.socket=io(this.opts.endpoint||"http://"+a.location.hostname+":3030");this.client=feathers().configure(feathers.hooks()).configure(feathers.socketio(this.socket));if(typeof this.opts.service!="undefined"&&this.opts.view){this.service=this.client.service(this.opts.service);var m=[this.opts.service,this.opts.view].join("_");this.eventMap={actionDeleteConfirmation:m+"_delete_confirmation",actionDeleteConfirmed:m+"_delete",actionEditSave:this.opts.service+"_save",actionCreateSave:this.opts.service+"_create",actionQuery:this.opts.service+"_query"};this.on("*",n=>{switch(n){case"mount":break;case"before-mount":case"unmount":if(n=="before-mount"){j.loadDependencies()}for(var p=Object.keys(j.eventMap),i=0;i<p.length;i++){if(n=="unmount"){RiotControl.off(j.eventMap[p[i]])}else{j.bindEvent(j.eventMap[p[i]],p[i])}}break;default:if(j.debug)console.info("FeatherClientMixin event:"+n,j.opts.title);break;}})}else{if(this.debug)console.warn("FeatherClientMixin no service",this.root.tagName)}},bindEvent:function h(j,l){var m=this;RiotControl.on(j,function(e){if(this.debug){console.info(map[i],this.eventMap[map[i]],e,m.opts,m.eventMap,Object.keys(m))}m[l](e)})},actionQuery:function h(j){if(this.opts.view=="list")return;this.loadData({id:j})},actionDeleteConfirmation:function h(j){console.info("actionDeleteConfirmation",j,this.data);RiotControl.trigger("delete_confirmation_modal",this.opts.service,this.opts.view,j||this.data._id||this.selection)},actionDeleteConfirmed:function h(j){var l=this;if((typeof j=="undefined"?"undefined":_typeof(j))==="object"){var m=j.map(_id=>_id.toString()),n={query:{_id:{$in:m}}};j=null}l.service.remove(j,n).then(p=>{if(l.opts.view!="list"){f([l.opts.service,"list"].join("/"))}else{l.refresh()}}).catch(p=>{console.error(p);RiotControl.trigger("notification",p.errorType+" "+l.eventMap.actionDeleteConfirmed,"error",p.message)})},actionEditSave:function h(){var j=this;console.error(j.opts.service);var l=j.getData();if(l==!1)return!1;j.service.update(l[j.opts.idfield],l).then(m=>{}).catch(m=>{RiotControl.trigger("notification",m.errorType+" "+j.eventMap.actionEditSave,"error",m.message)})},actionCreateSave:function h(){var j=this,l=j.getData();if(l==!1)return!1;delete l._id;delete l.id;console.error("actionCreateSave",l);j.service.create(l).then(m=>{}).catch(m=>{console.error(m);RiotControl.trigger("notification",m.errorType+" "+j.eventMap.actionCreateSave,"error",m.message)})},loadDependencies:function h(j){var l=this;if(l.dependencies&&l.dependencies.length==0){l.loadSchema(j)}else{console.log("loadDependencies",l.opts.title,l.opts.schema);RiotCrudController.loadDependencies(l.dependencies,l.opts.title,l.loadSchema(j))}},loadSchema:function h(j){var l=this;console.log("loadSchema",l.opts.title,l.opts.schema);if(l.opts.schema===!0){l.service.get("schema").then(m=>{l.opts.schema=m;l.loadData(l.opts.query)}).catch(m=>{console.error("loadSchema",m)})}else{l.loadData(l.opts.query)}},loadData:function h(j){var l=this;switch(l.opts.view){case"view":case"edit":if(j.id)l.service.get(j.id).then(m=>{l.data=m;if(typeof l.initView=="undefined"){l.update()}else{l.initView()}}).catch(m=>{console.error("loadData",m)});break;case"list":l.service.find(j).then(m=>{l.data=m;if(typeof l.initView=="undefined"){l.update()}else{l.initView()}}).catch(m=>{console.error("loadData",m)});break;default:break;}}});b.mixin("ViewActionsMixin",{init:function h(){var j=this,l=["View","Edit","Create","Delete","Save","List","Print","PDF","CSV","Json","Upload"].map((action,index)=>({name:action.toLowerCase(),label:action}));this.on("*",m=>{var n=j;if(m=="before-mount"||m=="update"){var p=j.opts.view||"undefined";j.opts.actions=l.map((q,r)=>{q.active=!1;if(["delete","print","pdf","csv","json"].indexOf(q.name)!=-1){q.count=n.opts.selection||0}switch(p){case"view":if(["edit","delete","create","list"].indexOf(q.name)!=-1){q.active=!0;delete q.count}break;case"edit":if(["save","view","delete","list"].indexOf(q.name)!=-1){q.active=!0;delete q.count}break;case"create":if(["save","list"].indexOf(q.name)!=-1){q.active=!0}break;case"list":if(["delete","create","print","pdf","csv","json","upload"].indexOf(q.name)!=-1){q.active=!0}break;default:break;}if(n.opts.buttons&&n.opts.buttons[q.name]){q.active=!0}return q})}})},actionClick:function h(e){e.preventDefault();if(e.item.action.count===0){return}var j=this.opts.service||this.opts.name,l=this.opts.view,m=e.item.action.name;console.info(Object.keys(e.item));switch(m){case"delete":var n=[j,l,m,"confirmation"].join("_");RiotControl.trigger(n);break;case"save":case"update":if(l=="create"){m="create"}var n=[j,m].join("_");RiotControl.trigger(n);break;case"view":case"edit":f([j,m,this.opts.query.id].join("/"));break;case"list":case"create":f([j,m].join("/"));break;case"upload":break;default:console.error("unknown event: "+[j,l,m].join("_"));break;}}})})(window,riot,route);